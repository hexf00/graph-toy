# 功能和界面设计

## 数据层设计

* 数据层设计细节
  * 数据层和g6实例的绑定实现细节：是将g6实例注册到数据层？还是将数据层实例以g6参数的形式传入后调用？
    * 确定的几点
      * 数据层不只是要更新g6实例，还需要更新vue实例的数据，数据层不应该管理所有数据实例
      * 我们操作g6时，对g6的操作代码也应该和g6耦合，再数据层中直接操作g6实例，这就导致数据层和g6耦合，这种耦关系并不合适的
    * 假设把数据层实例传入g6实例中
      * 我们可以判断g6是否绑定了数据层，如果没有则直接执行操作，有才去通知
      * 从事件触发的角度来看，g6仅仅时数据生产者，数据层是数据消费者，g6实例等待数据层的返回后再决定如何绘图
      * 可以预见不足是：我们不知道一个数据层会被多少实例调用，但数据层却是不需要关心这些的，这种关系可以记录在文档中
      * 1给数据层可以有多个g6实例，但g6实例只能绑定一个数据层实例，从这个角度来看是合适的

* 为什么不使用G6的数据做为持久存储的数据？
  * 一份数据只能单图应用，限制了使用场景
    * 相关的节点在画布中距离太远，但中间间隔的是与当前主题无关的内容，增加了操作了图理解的难度，比较理想的解决方案就是通过明确当前图的主题，只展示当前图内相关联的节点和概念。
  * 如果使用G6作为主数据，当我们需要在两个画布中展示同一批数据就会出现数据同步问题，如两个页面中打开，或者一个页面中两个画布中展示不同的数据
    * 解决数据同步的问题，就是要有一个为准的数据，同时要又一个在多个图之间进行同步修改的机制
* 关于同步机制的关键点
  * 需要考虑到数据同步失败的情况
  * 先更新谁的数据？
    * 被操作的实例 > 数据层 > 其它实例
      * 弊端1: 如果数据层更新失败（如网络原因），将需要将操作实例
      * 弊端2：需要对画布进行区分
    * 数据层 > 被操作的实例 > 其它实例
      * 弊端：需要对画布进行区分
    * 数据层 > 所有实例
      * 好处1：无需判断画布，实现逻辑直观简单
      * 好处2：如果数据层修改失败，也无需对数据进行回滚，只需给出提示
      * 弊端：画布实例操作监听代码和操作调用被分割，画布实例操作的地方没有操作画布代码的调用，虽然说不是不可以，但是这样导致画布和数据层强制耦合在一起，无法分开，g6实例将无法独立使用操作，因为没有对应的绘图代码，这有些不合理。
    * 数据层ok > 被操作的实例 ; 数据层ok > 事件广场 > 其它实例
      * 这种方式更加合理
    * 如果先改数据层，就只能使用拦截方式。
  * 通知数据层更新的主体是？即代码写在哪
    * 拦截处
  * 通知其它画布更新的主体是？即代码写在哪
    * 拦截处
      * 意味着需要在这里获取其它的画布
      * G6中对数据操作的地方较多，tab、delete快捷键、拖拽等等，增加维护难度
    * 数据层发出通知
      * 在拦截处仅仅作通知，而没有任何具体的代码，数据层改变后再发出让实例数据改变的通知，这样可以减少维护成本
  * 监测还是拦截G6中导致数据改变的操作
    * 监测方式：使用G6提供的事件监测G6数据改变，或修改代码
    * 拦截方式：只能在操作G6数据的源码处进行修改
* 总结
  * 在G6实例操作发出通知，接收通知后通知数据层更新，数据层更新成功后，通知g6画布更新，g6画布接受到通知后更新画布数据

## 功能统计

需要对代码结构做一次精简调整，为底层优化调整做准备，删除使用频率低的功能。

* 涉及数据修改
  * 建立节点/边
    * tab快捷键创建
    * 按钮-阅读器中划词创建
    * 双击在空白处创建节点
    * 拖拽建立连线

      在图的数据比较少的时候，通过这种方式建立连线使用比较理想，在图的数据变多后，通过这种方式建立连线变得很不方便。

      * 拖拽节点到另一个节点建立连线
      * 拖拽选中节点到另一个节点建立连线
  * 更新选中节点/边数据
    * 面板保存按钮，包含各种属性
    * 顶部按钮-为选中节点设置分类
    * 改变节点/边位置
      * 拖拽单个节点
      * 拖拽选中节点
      * 右键菜单-选中节点重新布局

        实际使用发现该功能布局方向不受控制，比较鸡肋。

  * 删除选中节点/边
    * delete快捷键
  * 顶部按钮-导入
  * 改变样式数据的
    * 顶部按钮-显示被隐藏的边
    * 顶部按钮-节点label显示分类
* 不涉及数据修改的
  * 选择节点/边
    * 拖拽框选
* 暂时移除的功能
  * 涉及数据修改
    * [x] 双击出现编辑框
    * [ ] 顶部按钮-为选中节点设置分类
    * [ ] 顶部按钮-显示被隐藏的边
    * [ ] 顶部按钮-节点label显示分类
    * [ ] 右键菜单-选中节点重新布局

## 功能

1. [ ] 阅读器
  阅读器显示自定义添加的HTML文档，同时对节点label进行标注处理，点击标注可以自动聚焦到图内的节点，通过关系可视化辅助思考，注：节点的关系需要自行建立。

2. [x] 自动保存数据
   实现的最简单版本，2020年1月26日。

3. [x] 节点聚焦/搜索/新增/编辑
4. [ ] 属性允许关联节点
5. [ ] 添加特殊的节点类型：分类节点，与分类节点的联系将不会被绘制
6. [ ] 节点允许添加js脚本提高自定义能力

## 界面

界面分为 图编辑器区、搜索区、阅读器区、属性面板区
